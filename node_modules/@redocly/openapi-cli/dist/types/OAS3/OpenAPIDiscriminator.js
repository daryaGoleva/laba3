"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.MAPPING_DATA_KEY = void 0;

var _traverse = _interopRequireDefault(require("../../traverse.js"));

var _OpenAPISchema = _interopRequireDefault(require("./OpenAPISchema"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/* eslint-disable import/no-cycle */
const MAPPING_DATA_KEY = 'x-openapiCli_resolveMappingData';
exports.MAPPING_DATA_KEY = MAPPING_DATA_KEY;
var _default = {
  name: 'OpenAPIDiscriminator',
  isIdempotent: true,
  properties: {
    propertyName: null,
    mapping: null
  },
  customResolveFields: async (node, ctx, visited) => {
    if (node && node.mapping && typeof node.mapping === 'object') {
      ctx.path.push('mapping');

      for (const key of Object.keys(node.mapping)) {
        ctx.path.push(key);
        await (0, _traverse.default)({
          $ref: node.mapping[key],
          [MAPPING_DATA_KEY]: {
            // FIXME: too hacky
            mapping: node.mapping,
            key
          }
        }, _OpenAPISchema.default, ctx, visited);
        ctx.path.pop();
      }

      ctx.path.pop();
    }
  }
};
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy90eXBlcy9PQVMzL09wZW5BUElEaXNjcmltaW5hdG9yLmpzIl0sIm5hbWVzIjpbIk1BUFBJTkdfREFUQV9LRVkiLCJuYW1lIiwiaXNJZGVtcG90ZW50IiwicHJvcGVydGllcyIsInByb3BlcnR5TmFtZSIsIm1hcHBpbmciLCJjdXN0b21SZXNvbHZlRmllbGRzIiwibm9kZSIsImN0eCIsInZpc2l0ZWQiLCJwYXRoIiwicHVzaCIsImtleSIsIk9iamVjdCIsImtleXMiLCIkcmVmIiwiT3BlbkFQSVNjaGVtYSIsInBvcCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUNBOztBQUNBOzs7O0FBRkE7QUFJTyxNQUFNQSxnQkFBZ0IsR0FBRyxpQ0FBekI7O2VBRVE7QUFDYkMsRUFBQUEsSUFBSSxFQUFFLHNCQURPO0FBRWJDLEVBQUFBLFlBQVksRUFBRSxJQUZEO0FBR2JDLEVBQUFBLFVBQVUsRUFBRTtBQUNWQyxJQUFBQSxZQUFZLEVBQUUsSUFESjtBQUVWQyxJQUFBQSxPQUFPLEVBQUU7QUFGQyxHQUhDO0FBT2JDLEVBQUFBLG1CQUFtQixFQUFFLE9BQU9DLElBQVAsRUFBYUMsR0FBYixFQUFrQkMsT0FBbEIsS0FBOEI7QUFDakQsUUFBSUYsSUFBSSxJQUFJQSxJQUFJLENBQUNGLE9BQWIsSUFBd0IsT0FBT0UsSUFBSSxDQUFDRixPQUFaLEtBQXdCLFFBQXBELEVBQThEO0FBQzVERyxNQUFBQSxHQUFHLENBQUNFLElBQUosQ0FBU0MsSUFBVCxDQUFjLFNBQWQ7O0FBQ0EsV0FBSyxNQUFNQyxHQUFYLElBQWtCQyxNQUFNLENBQUNDLElBQVAsQ0FBWVAsSUFBSSxDQUFDRixPQUFqQixDQUFsQixFQUE2QztBQUMzQ0csUUFBQUEsR0FBRyxDQUFDRSxJQUFKLENBQVNDLElBQVQsQ0FBY0MsR0FBZDtBQUNBLGNBQU0sdUJBQ0o7QUFDRUcsVUFBQUEsSUFBSSxFQUFFUixJQUFJLENBQUNGLE9BQUwsQ0FBYU8sR0FBYixDQURSO0FBRUUsV0FBQ1osZ0JBQUQsR0FBb0I7QUFBRTtBQUNwQkssWUFBQUEsT0FBTyxFQUFFRSxJQUFJLENBQUNGLE9BREk7QUFFbEJPLFlBQUFBO0FBRmtCO0FBRnRCLFNBREksRUFRSkksc0JBUkksRUFTSlIsR0FUSSxFQVVKQyxPQVZJLENBQU47QUFZQUQsUUFBQUEsR0FBRyxDQUFDRSxJQUFKLENBQVNPLEdBQVQ7QUFDRDs7QUFDRFQsTUFBQUEsR0FBRyxDQUFDRSxJQUFKLENBQVNPLEdBQVQ7QUFDRDtBQUNGO0FBNUJZLEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBpbXBvcnQvbm8tY3ljbGUgKi9cbmltcG9ydCB0cmF2ZXJzZU5vZGUgZnJvbSAnLi4vLi4vdHJhdmVyc2UuanMnO1xuaW1wb3J0IE9wZW5BUElTY2hlbWEgZnJvbSAnLi9PcGVuQVBJU2NoZW1hJztcblxuZXhwb3J0IGNvbnN0IE1BUFBJTkdfREFUQV9LRVkgPSAneC1vcGVuYXBpQ2xpX3Jlc29sdmVNYXBwaW5nRGF0YSc7XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgbmFtZTogJ09wZW5BUElEaXNjcmltaW5hdG9yJyxcbiAgaXNJZGVtcG90ZW50OiB0cnVlLFxuICBwcm9wZXJ0aWVzOiB7XG4gICAgcHJvcGVydHlOYW1lOiBudWxsLFxuICAgIG1hcHBpbmc6IG51bGwsXG4gIH0sXG4gIGN1c3RvbVJlc29sdmVGaWVsZHM6IGFzeW5jIChub2RlLCBjdHgsIHZpc2l0ZWQpID0+IHtcbiAgICBpZiAobm9kZSAmJiBub2RlLm1hcHBpbmcgJiYgdHlwZW9mIG5vZGUubWFwcGluZyA9PT0gJ29iamVjdCcpIHtcbiAgICAgIGN0eC5wYXRoLnB1c2goJ21hcHBpbmcnKTtcbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKG5vZGUubWFwcGluZykpIHtcbiAgICAgICAgY3R4LnBhdGgucHVzaChrZXkpO1xuICAgICAgICBhd2FpdCB0cmF2ZXJzZU5vZGUoXG4gICAgICAgICAge1xuICAgICAgICAgICAgJHJlZjogbm9kZS5tYXBwaW5nW2tleV0sXG4gICAgICAgICAgICBbTUFQUElOR19EQVRBX0tFWV06IHsgLy8gRklYTUU6IHRvbyBoYWNreVxuICAgICAgICAgICAgICBtYXBwaW5nOiBub2RlLm1hcHBpbmcsXG4gICAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBPcGVuQVBJU2NoZW1hLFxuICAgICAgICAgIGN0eCxcbiAgICAgICAgICB2aXNpdGVkLFxuICAgICAgICApO1xuICAgICAgICBjdHgucGF0aC5wb3AoKTtcbiAgICAgIH1cbiAgICAgIGN0eC5wYXRoLnBvcCgpO1xuICAgIH1cbiAgfSxcbn07XG4iXX0=