"use strict";

var _utils = require("../../../utils");

class ValidateOAS2Schema {
  static get rule() {
    return 'oas2-schema/schema';
  }

  get validators() {
    return {
      title(node, ctx) {
        if (node && node.title) {
          if (!(typeof node.title === 'string')) return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        }

        return null;
      },

      multipleOf(node, ctx) {
        if (node && node.multipleOf) {
          if (typeof node.multipleOf !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.multipleOf < 0) return ctx.createError('Value of multipleOf must be greater or equal to zero', 'value');
        }

        return null;
      },

      maximum(node, ctx) {
        if (node && node.maximum && typeof node.maximum !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      exclusiveMaximum(node, ctx) {
        if (node && node.exclusiveMaximum && typeof node.exclusiveMaximum !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      minimum(node, ctx) {
        if (node && node.minimum && typeof node.minimum !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      exclusiveMinimum(node, ctx) {
        if (node && node.exclusiveMinimum && typeof node.exclusiveMinimum !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      maxLength(node, ctx) {
        if (node && node.maxLength) {
          if (typeof node.maxLength !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.maxLength < 0) return ctx.createError('Value of maxLength must be greater or equal to zero.', 'value');
        }

        return null;
      },

      minLength(node, ctx) {
        if (node && node.minLength) {
          if (typeof node.minLength !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.minLength < 0) return ctx.createError('Value of minLength must be greater or equal to zero.', 'value');
        }

        return null;
      },

      pattern(node, ctx) {
        if (node && node.pattern) {
          // TODO: add regexp validation.
          if (typeof node.pattern !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        }

        return null;
      },

      maxItems(node, ctx) {
        if (node && node.maxItems) {
          if (typeof node.maxItems !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.maxItems < 0) return ctx.createError('Value of maxItems must be greater or equal to zero. You can`t have negative amount of something.', 'value');
        }

        return null;
      },

      minItems(node, ctx) {
        if (node && node.minItems) {
          if (typeof node.minItems !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.minItems < 0) return ctx.createError('Value of minItems must be greater or equal to zero. You can`t have negative amount of something.', 'value');
        }

        return null;
      },

      uniqueItems(node, ctx) {
        if (node && node.uniqueItems) {
          if (typeof node.uniqueItems !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        }

        return null;
      },

      maxProperties(node, ctx) {
        if (node && node.maxProperties) {
          if (typeof node.maxProperties !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.maxProperties < 0) return ctx.createError('Value of maxProperties must be greater or equal to zero. You can`t have negative amount of something.', 'value');
        }

        return null;
      },

      minProperties(node, ctx) {
        if (node && node.minProperties) {
          if (typeof node.minProperties !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.minProperties < 0) return ctx.createError('Value of minProperties must be greater or equal to zero. You can`t have negative amount of something.', 'value');
        }

        return null;
      },

      required(node, ctx) {
        if (node && node.required) {
          if (!Array.isArray(node.required)) return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('array'), 'value');
          if (node.required.filter(item => typeof item !== 'string').length !== 0) return ctx.createError('All values of "required" field must be strings', 'value');
        }

        return null;
      },

      enum(node, ctx) {
        const errors = [];

        if (node && node.enum) {
          if (!Array.isArray(node.enum)) return [ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('array'), 'value')];
        }

        return errors;
      },

      type(node, ctx) {
        const errors = [];
        if (node.type && node.type && typeof node.type !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');

        if (node.type && !['string', 'object', 'array', 'integer', 'number', 'boolean', 'file'].includes(node.type)) {
          const possibleAlternate = (0, _utils.getClosestString)(node.type, ['string', 'object', 'array', 'integer', 'number', 'boolean']);
          errors.push(ctx.createError('Object type can be one of following only: "string", "object", "array", "integer", "number", "boolean".', 'value', {
            possibleAlternate
          }));
        }

        return errors;
      },

      items(node, ctx) {
        if (node && node.items && Array.isArray(node.items)) return ctx.createError('Value of items must not be an array. It must be a Schema object', 'value');
        return null;
      },

      additionalProperties: (node, ctx) => {
        if (node && node.additionalProperties && ['boolean', 'object'].indexOf(typeof node.additionalProperties) === -1) {
          return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean or OAS2 Schema'), 'value');
        }

        return null;
      },

      description(node, ctx) {
        if (node && node.description && typeof node.description !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      format(node, ctx) {
        if (node && node.format && typeof node.format !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      readOnly(node, ctx) {
        if (node && node.readOnly && typeof node.readOnly !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      deprecated(node, ctx) {
        if (node && node.deprecated && typeof node.deprecated !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      }

    };
  }

  OAS2Schema() {
    return {
      onEnter: (node, definition, ctx) => ctx.validateFields(this.config, this.rule, this.validators)
    };
  }

}

module.exports = ValidateOAS2Schema;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy92aXNpdG9ycy9ydWxlcy9vYXMyLXN0cnVjdHVyYWwvdmFsaWRhdGVPQVMyU2NoZW1hLmpzIl0sIm5hbWVzIjpbIlZhbGlkYXRlT0FTMlNjaGVtYSIsInJ1bGUiLCJ2YWxpZGF0b3JzIiwidGl0bGUiLCJub2RlIiwiY3R4IiwiY3JlYXRlRXJyb3IiLCJtZXNzYWdlSGVscGVycyIsImZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlciIsIm11bHRpcGxlT2YiLCJtYXhpbXVtIiwiZXhjbHVzaXZlTWF4aW11bSIsIm1pbmltdW0iLCJleGNsdXNpdmVNaW5pbXVtIiwibWF4TGVuZ3RoIiwibWluTGVuZ3RoIiwicGF0dGVybiIsIm1heEl0ZW1zIiwibWluSXRlbXMiLCJ1bmlxdWVJdGVtcyIsIm1heFByb3BlcnRpZXMiLCJtaW5Qcm9wZXJ0aWVzIiwicmVxdWlyZWQiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJpdGVtIiwibGVuZ3RoIiwiZW51bSIsImVycm9ycyIsInR5cGUiLCJpbmNsdWRlcyIsInBvc3NpYmxlQWx0ZXJuYXRlIiwicHVzaCIsIml0ZW1zIiwiYWRkaXRpb25hbFByb3BlcnRpZXMiLCJpbmRleE9mIiwiZGVzY3JpcHRpb24iLCJmb3JtYXQiLCJyZWFkT25seSIsImRlcHJlY2F0ZWQiLCJPQVMyU2NoZW1hIiwib25FbnRlciIsImRlZmluaXRpb24iLCJ2YWxpZGF0ZUZpZWxkcyIsImNvbmZpZyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7O0FBQUE7O0FBRUEsTUFBTUEsa0JBQU4sQ0FBeUI7QUFDdkIsYUFBV0MsSUFBWCxHQUFrQjtBQUNoQixXQUFPLG9CQUFQO0FBQ0Q7O0FBRUQsTUFBSUMsVUFBSixHQUFpQjtBQUNmLFdBQU87QUFDTEMsTUFBQUEsS0FBSyxDQUFDQyxJQUFELEVBQU9DLEdBQVAsRUFBWTtBQUNmLFlBQUlELElBQUksSUFBSUEsSUFBSSxDQUFDRCxLQUFqQixFQUF3QjtB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RUFBT0MsR0FBUCxFQUFZO0FBQ3BCLFlBQUlELElBQUksSUFBSUEsSUFBSSxDQUFDb0MsVUFBYixJQUEyQixPQUFPcEMsSUFBSSxDQUFDb0MsVUFBWixLQUEyQixTQUExRCxFQUFxRSxPQUFPbkMsR0FBRyxDQUFDQyxXQUFKLENBQWdCRCxHQUFHLENBQUNFLGNBQUosQ0FBbUJDLDhCQUFuQixDQUFrRCxTQUFsRCxDQUFoQixFQUE4RSxPQUE5RSxDQUFQO0FBQ3JFLGVBQU8sSUFBUDtBQUNEOztBQXhJSSxLQUFQO0FBMElEOztBQUVEaUMsRUFBQUEsVUFBVSxHQUFHO0FBQ1gsV0FBTztBQUNMQyxNQUFBQSxPQUFPLEVBQUUsQ0FBQ3RDLElBQUQsRUFBT3VDLFVBQVAsRUFBbUJ0QyxHQUFuQixLQUEyQkEsR0FBRyxDQUFDdUMsY0FBSixDQUNsQyxLQUFLQyxNQUQ2QixFQUNyQixLQUFLNUMsSUFEZ0IsRUFDVixLQUFLQyxVQURLO0FBRC9CLEtBQVA7QUFLRDs7QUF4SnNCOztBQTJKekI0QyxNQUFNLENBQUNDLE9BQVAsR0FBaUIvQyxrQkFBakIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBtYXRjaGVzSnNvblNjaGVtYVR5cGUsIGdldENsb3Nlc3RTdHJpbmcgfSBmcm9tICcuLi8uLi8uLi91dGlscyc7XG5cbmNsYXNzIFZhbGlkYXRlT0FTMlNjaGVtYSB7XG4gIHN0YXRpYyBnZXQgcnVsZSgpIHtcbiAgICByZXR1cm4gJ29hczItc2NoZW1hL3NjaGVtYSc7XG4gIH1cblxuICBnZXQgdmFsaWRhdG9ycygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdGl0bGUobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUudGl0bGUpIHtcbiAgICAgICAgICBpZiAoISh0eXBlb2Ygbm9kZS50aXRsZSA9PT0gJ3N0cmluZycpKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ3N0cmluZycpLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBtdWx0aXBsZU9mKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLm11bHRpcGxlT2YpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIG5vZGUubXVsdGlwbGVPZiAhPT0gJ251bWJlcicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignbnVtYmVyJyksICd2YWx1ZScpO1xuICAgICAgICAgIGlmIChub2RlLm11bHRpcGxlT2YgPCAwKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKCdWYWx1ZSBvZiBtdWx0aXBsZU9mIG11c3QgYmUgZ3JlYXRlciBvciBlcXVhbCB0byB6ZXJvJywgJ3ZhbHVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgbWF4aW11bShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5tYXhpbXVtICYmIHR5cGVvZiBub2RlLm1heGltdW0gIT09ICdudW1iZXInKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ251bWJlcicpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgZXhjbHVzaXZlTWF4aW11bShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5leGNsdXNpdmVNYXhpbXVtICYmIHR5cGVvZiBub2RlLmV4Y2x1c2l2ZU1heGltdW0gIT09ICdib29sZWFuJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdib29sZWFuJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBtaW5pbXVtKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLm1pbmltdW0gJiYgdHlwZW9mIG5vZGUubWluaW11bSAhPT0gJ251bWJlcicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignbnVtYmVyJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBleGNsdXNpdmVNaW5pbXVtKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLmV4Y2x1c2l2ZU1pbmltdW0gJiYgdHlwZW9mIG5vZGUuZXhjbHVzaXZlTWluaW11bSAhPT0gJ2Jvb2xlYW4nKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ2Jvb2xlYW4nKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG1heExlbmd0aChub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5tYXhMZW5ndGgpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIG5vZGUubWF4TGVuZ3RoICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgICAgaWYgKG5vZGUubWF4TGVuZ3RoIDwgMCkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVmFsdWUgb2YgbWF4TGVuZ3RoIG11c3QgYmUgZ3JlYXRlciBvciBlcXVhbCB0byB6ZXJvLicsICd2YWx1ZScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG1pbkxlbmd0aChub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5taW5MZW5ndGgpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIG5vZGUubWluTGVuZ3RoICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgICAgaWYgKG5vZGUubWluTGVuZ3RoIDwgMCkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVmFsdWUgb2YgbWluTGVuZ3RoIG11c3QgYmUgZ3JlYXRlciBvciBlcXVhbCB0byB6ZXJvLicsICd2YWx1ZScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIHBhdHRlcm4obm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUucGF0dGVybikge1xuICAgICAgICAgIC8vIFRPRE86IGFkZCByZWdleHAgdmFsaWRhdGlvbi5cbiAgICAgICAgICBpZiAodHlwZW9mIG5vZGUucGF0dGVybiAhPT0gJ3N0cmluZycpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignc3RyaW5nJyksICd2YWx1ZScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG1heEl0ZW1zKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLm1heEl0ZW1zKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBub2RlLm1heEl0ZW1zICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgICAgaWYgKG5vZGUubWF4SXRlbXMgPCAwKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKCdWYWx1ZSBvZiBtYXhJdGVtcyBtdXN0IGJlIGdyZWF0ZXIgb3IgZXF1YWwgdG8gemVyby4gWW91IGNhbmB0IGhhdmUgbmVnYXRpdmUgYW1vdW50IG9mIHNvbWV0aGluZy4nLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBtaW5JdGVtcyhub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5taW5JdGVtcykge1xuICAgICAgICAgIGlmICh0eXBlb2Ygbm9kZS5taW5JdGVtcyAhPT0gJ251bWJlcicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignbnVtYmVyJyksICd2YWx1ZScpO1xuICAgICAgICAgIGlmIChub2RlLm1pbkl0ZW1zIDwgMCkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVmFsdWUgb2YgbWluSXRlbXMgbXVzdCBiZSBncmVhdGVyIG9yIGVxdWFsIHRvIHplcm8uIFlvdSBjYW5gdCBoYXZlIG5lZ2F0aXZlIGFtb3VudCBvZiBzb21ldGhpbmcuJywgJ3ZhbHVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgdW5pcXVlSXRlbXMobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUudW5pcXVlSXRlbXMpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIG5vZGUudW5pcXVlSXRlbXMgIT09ICdib29sZWFuJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdib29sZWFuJyksICd2YWx1ZScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG1heFByb3BlcnRpZXMobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubWF4UHJvcGVydGllcykge1xuICAgICAgICAgIGlmICh0eXBlb2Ygbm9kZS5tYXhQcm9wZXJ0aWVzICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgICAgaWYgKG5vZGUubWF4UHJvcGVydGllcyA8IDApIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1ZhbHVlIG9mIG1heFByb3BlcnRpZXMgbXVzdCBiZSBncmVhdGVyIG9yIGVxdWFsIHRvIHplcm8uIFlvdSBjYW5gdCBoYXZlIG5lZ2F0aXZlIGFtb3VudCBvZiBzb21ldGhpbmcuJywgJ3ZhbHVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgbWluUHJvcGVydGllcyhub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5taW5Qcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBub2RlLm1pblByb3BlcnRpZXMgIT09ICdudW1iZXInKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ251bWJlcicpLCAndmFsdWUnKTtcbiAgICAgICAgICBpZiAobm9kZS5taW5Qcm9wZXJ0aWVzIDwgMCkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVmFsdWUgb2YgbWluUHJvcGVydGllcyBtdXN0IGJlIGdyZWF0ZXIgb3IgZXF1YWwgdG8gemVyby4gWW91IGNhbmB0IGhhdmUgbmVnYXRpdmUgYW1vdW50IG9mIHNvbWV0aGluZy4nLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICByZXF1aXJlZChub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5yZXF1aXJlZCkge1xuICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShub2RlLnJlcXVpcmVkKSkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdhcnJheScpLCAndmFsdWUnKTtcbiAgICAgICAgICBpZiAobm9kZS5yZXF1aXJlZC5maWx0ZXIoKGl0ZW0pID0+IHR5cGVvZiBpdGVtICE9PSAnc3RyaW5nJykubGVuZ3RoICE9PSAwKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKCdBbGwgdmFsdWVzIG9mIFwicmVxdWlyZWRcIiBmaWVsZCBtdXN0IGJlIHN0cmluZ3MnLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBlbnVtKG5vZGUsIGN0eCkge1xuICAgICAgICBjb25zdCBlcnJvcnMgPSBbXTtcblxuICAgICAgICBpZiAobm9kZSAmJiBub2RlLmVudW0pIHtcbiAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkobm9kZS5lbnVtKSkgcmV0dXJuIFtjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignYXJyYXknKSwgJ3ZhbHVlJyldO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlcnJvcnM7XG4gICAgICB9LFxuICAgICAgdHlwZShub2RlLCBjdHgpIHtcbiAgICAgICAgY29uc3QgZXJyb3JzID0gW107XG4gICAgICAgIGlmIChub2RlLnR5cGUgJiYgbm9kZS50eXBlICYmIHR5cGVvZiBub2RlLnR5cGUgIT09ICdzdHJpbmcnKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ3N0cmluZycpLCAndmFsdWUnKTtcbiAgICAgICAgaWYgKG5vZGUudHlwZSAmJiAhWydzdHJpbmcnLCAnb2JqZWN0JywgJ2FycmF5JywgJ2ludGVnZXInLCAnbnVtYmVyJywgJ2Jvb2xlYW4nLCAnZmlsZSddLmluY2x1ZGVzKG5vZGUudHlwZSkpIHtcbiAgICAgICAgICBjb25zdCBwb3NzaWJsZUFsdGVybmF0ZSA9IGdldENsb3Nlc3RTdHJpbmcobm9kZS50eXBlLCBbJ3N0cmluZycsICdvYmplY3QnLCAnYXJyYXknLCAnaW50ZWdlcicsICdudW1iZXInLCAnYm9vbGVhbiddKTtcbiAgICAgICAgICBlcnJvcnMucHVzaChjdHguY3JlYXRlRXJyb3IoJ09iamVjdCB0eXBlIGNhbiBiZSBvbmUgb2YgZm9sbG93aW5nIG9ubHk6IFwic3RyaW5nXCIsIFwib2JqZWN0XCIsIFwiYXJyYXlcIiwgXCJpbnRlZ2VyXCIsIFwibnVtYmVyXCIsIFwiYm9vbGVhblwiLicsICd2YWx1ZScsIHsgcG9zc2libGVBbHRlcm5hdGUgfSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlcnJvcnM7XG4gICAgICB9LFxuICAgICAgaXRlbXMobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuaXRlbXMgJiYgQXJyYXkuaXNBcnJheShub2RlLml0ZW1zKSkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVmFsdWUgb2YgaXRlbXMgbXVzdCBub3QgYmUgYW4gYXJyYXkuIEl0IG11c3QgYmUgYSBTY2hlbWEgb2JqZWN0JywgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIGFkZGl0aW9uYWxQcm9wZXJ0aWVzOiAobm9kZSwgY3R4KSA9PiB7XG4gICAgICAgIGlmIChub2RlXG4gICAgICAgICAgJiYgbm9kZS5hZGRpdGlvbmFsUHJvcGVydGllc1xuICAgICAgICAgICYmIChbJ2Jvb2xlYW4nLCAnb2JqZWN0J10uaW5kZXhPZih0eXBlb2Ygbm9kZS5hZGRpdGlvbmFsUHJvcGVydGllcykgPT09IC0xKSkge1xuICAgICAgICAgIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignYm9vbGVhbiBvciBPQVMyIFNjaGVtYScpLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBkZXNjcmlwdGlvbihub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5kZXNjcmlwdGlvbiAmJiB0eXBlb2Ygbm9kZS5kZXNjcmlwdGlvbiAhPT0gJ3N0cmluZycpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignc3RyaW5nJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBmb3JtYXQobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuZm9ybWF0ICYmIHR5cGVvZiBub2RlLmZvcm1hdCAhPT0gJ3N0cmluZycpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignc3RyaW5nJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICByZWFkT25seShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5yZWFkT25seSAmJiB0eXBlb2Ygbm9kZS5yZWFkT25seSAhPT0gJ2Jvb2xlYW4nKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ2Jvb2xlYW4nKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIGRlcHJlY2F0ZWQobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuZGVwcmVjYXRlZCAmJiB0eXBlb2Ygbm9kZS5kZXByZWNhdGVkICE9PSAnYm9vbGVhbicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignYm9vbGVhbicpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBPQVMyU2NoZW1hKCkge1xuICAgIHJldHVybiB7XG4gICAgICBvbkVudGVyOiAobm9kZSwgZGVmaW5pdGlvbiwgY3R4KSA9PiBjdHgudmFsaWRhdGVGaWVsZHMoXG4gICAgICAgIHRoaXMuY29uZmlnLCB0aGlzLnJ1bGUsIHRoaXMudmFsaWRhdG9ycyxcbiAgICAgICksXG4gICAgfTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFZhbGlkYXRlT0FTMlNjaGVtYTtcbiJdfQ==