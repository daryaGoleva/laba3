"use strict";

class ValidateOAS2SecurityScheme {
  static get rule() {
    return 'oas2-schema/security-scheme';
  }

  get validators() {
    return {
      type(node, ctx) {
        if (!node.type) return ctx.createError(ctx.messageHelpers.missingRequiredField('type'), 'key');
        if (typeof node.type !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      description(node, ctx) {
        if (node && node.description && typeof node.description !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      name(node, ctx) {
        if (!node.type || node.type !== 'apiKey') return null;
        if (!node.name) return ctx.createError(ctx.messageHelpers.missingRequiredField('name'), 'key');
        if (typeof node.name !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      in(node, ctx) {
        if (!node.type || node.type !== 'apiKey') return null;
        if (!node.in) return ctx.createError(ctx.messageHelpers.missingRequiredField('in'), 'key');
        if (typeof node.in !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        if (['query', 'header'].indexOf(node.in) === -1) return ctx.createError('Value of the "in" field can be only "query" or "header".', 'value');
        return null;
      },

      flow(node, ctx) {
        if (!node.type || node.type !== 'oauth2') return null;
        if (!node.flow) return ctx.createError(ctx.messageHelpers.missingRequiredField('flow'), 'key');
        if (typeof node.flow !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');

        if (['implicit', 'password', 'application', 'accessCode'].indexOf(node.flow) === -1) {
          return ctx.createError('Value of the "flow" field can be only "implicit", "password", "application", "accessCode".', 'value');
        }

        return null;
      },

      authorizationUrl(node, ctx) {
        if (!node.type || node.type !== 'oauth2') return null;
        if (!node.flow || ['implicit', 'accessCode'].indexOf(node.flow) === -1) return null;
        if (!node.authorizationUrl) return ctx.createError(ctx.messageHelpers.missingRequiredField('authorizationUrl'), 'key');
        if (typeof node.authorizationUrl !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      tokenUrl(node, ctx) {
        if (!node.type || node.type !== 'oauth2') return null;
        if (!node.flow || ['password', 'application', 'accessCode'].indexOf(node.flow) === -1) return null;
        if (!node.tokenUrl) return ctx.createError(ctx.messageHelpers.missingRequiredField('tokenUrl'), 'key');
        if (typeof node.tokenUrl !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      scopes(node, ctx) {
        if (!node.type || node.type !== 'oauth2') return null;
        if (!node.scopes) return ctx.createError(ctx.messageHelpers.missingRequiredField('scopes'), 'key');
        return null;
      }

    };
  }

  OAS2SecurityScheme() {
    return {
      onEnter: (node, definition, ctx) => ctx.validateFields(this.config, this.rule, this.validators)
    };
  }

}

module.exports = ValidateOAS2SecurityScheme;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy92aXNpdG9ycy9ydWxlcy9vYXMyLXN0cnVjdHVyYWwvdmFsaWRhdGVPQVMyU2VjdXJpdHlTY2hlbWUuanMiXSwibmFtZXMiOlsiVmFsaWRhdGVPQVMyU2VjdXJpdHlTY2hlbWUiLCJydWxlIiwidmFsaWRhdG9ycyIsInR5cGUiLCJub2RlIiwiY3R4IiwiY3JlYXRlRXJyb3IiLCJtZXNzYWdlSGVscGVycyIsIm1pc3NpbmdSZXF1aXJlZEZpZWxkIiwiZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyIiwiZGVzY3JpcHRpb24iLCJuYW1lIiwiaW4iLCJpbmRleE9mIiwiZmxvdyIsImF1dGhvcml6YXRpb25VcmwiLCJ0b2tlblVybCIsInNjb3BlcyIsIk9BUzJTZWN1cml0eVNjaGVtZSIsIm9uRW50ZXIiLCJkZWZpbml0aW9uIiwidmFsaWRhdGVGaWVsZHMiLCJjb25maWciLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU1BLDBCQUFOLENBQWlDO0FBQy9CLGFBQVdDLElBQVgsR0FBa0I7QUFDaEIsV0FBTyw2QkFBUDtBQUNEOztBQUVELE1BQUlDLFVBQUosR0FBaUI7QUFDZixXQUFPO0FBQ0xDLE1BQUFBLElBQUksQ0FBQ0MsSUFBRCxFQUFPQyxHQUFQLEVBQVk7QUFDZCxZQUFJLENBQUNELElBQUksQ0FBQ0QsSUFBVixFQUFnQixPQUFPRSxHQUFHLENBQUNDLFdBQUosQ0FBZ0JELEdBQUcsQ0FBQ0UsY0FBSixDQUFtQkMsb0JBQW5CLENBQXdDLE1BQXhDLENBQWhCLEVBQWlFLEtBQWpFLENBQVA7QUFDaEIsWUFBSSxPQUFPSixJQUFJLENBQUNELElBQVosS0FBcUIsUUFBekIsRUFBbUMsT0FBT0UsR0FBRyxDQUFDQyxXQUFKLENBQWdCRCxHQUFHLENBQUNFLGNBQUosQ0FBbUJFLDhCQUFuQixDQUFrRCxRQUFsRCxDQUFoQixFQUE2RSxPQUE3RSxDQUFQO0FBQ25DLGVBQU8sSUFBUDtBQUNELE9B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IHN0YXRpYyBnZXQgcnVsZSgpIHtcbiAgICByZXR1cm4gJ29hczItc2NoZW1hL3NlY3VyaXR5LXNjaGVtZSc7XG4gIH1cblxuICBnZXQgdmFsaWRhdG9ycygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKCFub2RlLnR5cGUpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLm1pc3NpbmdSZXF1aXJlZEZpZWxkKCd0eXBlJyksICdrZXknKTtcbiAgICAgICAgaWYgKHR5cGVvZiBub2RlLnR5cGUgIT09ICdzdHJpbmcnKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ3N0cmluZycpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgZGVzY3JpcHRpb24obm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuZGVzY3JpcHRpb24gJiYgdHlwZW9mIG5vZGUuZGVzY3JpcHRpb24gIT09ICdzdHJpbmcnKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ3N0cmluZycpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgbmFtZShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKCFub2RlLnR5cGUgfHwgbm9kZS50eXBlICE9PSAnYXBpS2V5JykgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmICghbm9kZS5uYW1lKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5taXNzaW5nUmVxdWlyZWRGaWVsZCgnbmFtZScpLCAna2V5Jyk7XG4gICAgICAgIGlmICh0eXBlb2Ygbm9kZS5uYW1lICE9PSAnc3RyaW5nJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdzdHJpbmcnKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIGluKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAoIW5vZGUudHlwZSB8fCBub2RlLnR5cGUgIT09ICdhcGlLZXknKSByZXR1cm4gbnVsbDtcbiAgICAgICAgaWYgKCFub2RlLmluKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5taXNzaW5nUmVxdWlyZWRGaWVsZCgnaW4nKSwgJ2tleScpO1xuICAgICAgICBpZiAodHlwZW9mIG5vZGUuaW4gIT09ICdzdHJpbmcnKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ3N0cmluZycpLCAndmFsdWUnKTtcbiAgICAgICAgaWYgKFsncXVlcnknLCAnaGVhZGVyJ10uaW5kZXhPZihub2RlLmluKSA9PT0gLTEpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1ZhbHVlIG9mIHRoZSBcImluXCIgZmllbGQgY2FuIGJlIG9ubHkgXCJxdWVyeVwiIG9yIFwiaGVhZGVyXCIuJywgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIGZsb3cobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmICghbm9kZS50eXBlIHx8IG5vZGUudHlwZSAhPT0gJ29hdXRoMicpIHJldHVybiBudWxsO1xuICAgICAgICBpZiAoIW5vZGUuZmxvdykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMubWlzc2luZ1JlcXVpcmVkRmllbGQoJ2Zsb3cnKSwgJ2tleScpO1xuICAgICAgICBpZiAodHlwZW9mIG5vZGUuZmxvdyAhPT0gJ3N0cmluZycpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignc3RyaW5nJyksICd2YWx1ZScpO1xuICAgICAgICBpZiAoWydpbXBsaWNpdCcsICdwYXNzd29yZCcsICdhcHBsaWNhdGlvbicsICdhY2Nlc3NDb2RlJ10uaW5kZXhPZihub2RlLmZsb3cpID09PSAtMSkge1xuICAgICAgICAgIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1ZhbHVlIG9mIHRoZSBcImZsb3dcIiBmaWVsZCBjYW4gYmUgb25seSBcImltcGxpY2l0XCIsIFwicGFzc3dvcmRcIiwgXCJhcHBsaWNhdGlvblwiLCBcImFjY2Vzc0NvZGVcIi4nLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBhdXRob3JpemF0aW9uVXJsKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAoIW5vZGUudHlwZSB8fCBub2RlLnR5cGUgIT09ICdvYXV0aDInKSByZXR1cm4gbnVsbDtcbiAgICAgICAgaWYgKCFub2RlLmZsb3cgfHwgWydpbXBsaWNpdCcsICdhY2Nlc3NDb2RlJ10uaW5kZXhPZihub2RlLmZsb3cpID09PSAtMSkgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmICghbm9kZS5hdXRob3JpemF0aW9uVXJsKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5taXNzaW5nUmVxdWlyZWRGaWVsZCgnYXV0aG9yaXphdGlvblVybCcpLCAna2V5Jyk7XG4gICAgICAgIGlmICh0eXBlb2Ygbm9kZS5hdXRob3JpemF0aW9uVXJsICE9PSAnc3RyaW5nJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdzdHJpbmcnKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIHRva2VuVXJsKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAoIW5vZGUudHlwZSB8fCBub2RlLnR5cGUgIT09ICdvYXV0aDInKSByZXR1cm4gbnVsbDtcbiAgICAgICAgaWYgKCFub2RlLmZsb3cgfHwgWydwYXNzd29yZCcsICdhcHBsaWNhdGlvbicsICdhY2Nlc3NDb2RlJ10uaW5kZXhPZihub2RlLmZsb3cpID09PSAtMSkgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmICghbm9kZS50b2tlblVybCkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMubWlzc2luZ1JlcXVpcmVkRmllbGQoJ3Rva2VuVXJsJyksICdrZXknKTtcbiAgICAgICAgaWYgKHR5cGVvZiBub2RlLnRva2VuVXJsICE9PSAnc3RyaW5nJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdzdHJpbmcnKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIHNjb3Blcyhub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKCFub2RlLnR5cGUgfHwgbm9kZS50eXBlICE9PSAnb2F1dGgyJykgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmICghbm9kZS5zY29wZXMpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLm1pc3NpbmdSZXF1aXJlZEZpZWxkKCdzY29wZXMnKSwgJ2tleScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIE9BUzJTZWN1cml0eVNjaGVtZSgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgb25FbnRlcjogKG5vZGUsIGRlZmluaXRpb24sIGN0eCkgPT4gY3R4LnZhbGlkYXRlRmllbGRzKFxuICAgICAgICB0aGlzLmNvbmZpZywgdGhpcy5ydWxlLCB0aGlzLnZhbGlkYXRvcnMsXG4gICAgICApLFxuICAgIH07XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBWYWxpZGF0ZU9BUzJTZWN1cml0eVNjaGVtZTtcbiJdfQ==