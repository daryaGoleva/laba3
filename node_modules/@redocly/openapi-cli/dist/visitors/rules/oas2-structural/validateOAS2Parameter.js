"use strict";

class ValidateOAS2Parameter {
  static get rule() {
    return 'oas2-schema/parameter';
  }

  get validators() {
    return {
      name(node, ctx) {
        if (!node) return null;
        if (!node.name) return ctx.createError(ctx.messageHelpers.missingRequiredField('name'), 'key');
        if (typeof node.name !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      in(node, ctx) {
        if (!node) return null;
        if (!node.in) return ctx.createError(ctx.messageHelpers.missingRequiredField('in'), 'key');
        if (typeof node.in !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        if (!['query', 'header', 'path', 'body', 'formData'].includes(node.in)) return ctx.createError("The 'in' field value can be only one of: 'query', 'header', 'path', 'cookie'", 'value');
        return null;
      },

      description(node, ctx) {
        if (node && node.description && typeof node.description !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      required(node, ctx) {
        if (node && node.required && typeof node.required !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');

        if (node && node.in && node.in === 'path' && node.required !== true) {
          return ctx.createError('If the parameter location is "path", this property is REQUIRED and its value MUST be true.', 'value');
        }

        return null;
      },

      deprecated(node, ctx) {
        if (node && node.deprecated && typeof node.deprecated !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      schema(node, ctx) {
        if (node.in && node.in === 'body' && !node.schema) {
          return ctx.createError(ctx.messageHelpers.missingRequiredField('schema'), 'key');
        }

        if (!(node.in && node.in === 'body') && node.schema) {
          return ctx.createError('Schema field may be present only if parameter is in "body".', 'key');
        }

        return null;
      },

      type(node, ctx) {
        if (node.in && node.in === 'body' && node.type) {
          return ctx.createError('This field is allowed only if the parameter not in "body". In such case, use Schema object instead');
        }

        if (node && node.type && typeof node.type !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      format(node, ctx) {
        if (node.in && node.in === 'body' && node.format) {
          return ctx.createError('This field is allowed only if the parameter not in "body". In such case, use Schema object instead');
        }

        if (node && node.format && typeof node.format !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      allowEmptyValue(node, ctx) {
        if (node.in && node.in === 'body' && node.allowEmptyValue) {
          return ctx.createError('This field is allowed only if the parameter not in "body". In such case, use Schema object instead');
        }

        if (node && node.allowEmptyValue && typeof node.allowEmptyValue !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      items(node, ctx) {
        if (node.in && node.in === 'body' && node.items) {
          return ctx.createError('This field is allowed only if the parameter not in "body". In such case, use Schema object instead');
        }

        if (!(node.type && node.type === 'array') && node.items) {
          return ctx.createError('"Items" field may be present only if type of parameter is "array".', 'key');
        }

        if (node.type && node.type === 'array' && !node.items) {
          return ctx.createError(ctx.messageHelpers.missingRequiredField('items'), 'key');
        }

        return null;
      },

      pattern(node, ctx) {
        if (node.in && node.in === 'body' && node.pattern) {
          return ctx.createError('This field is allowed only if the parameter not in "body". In such case, use Schema object instead');
        }

        if (node && node.pattern && typeof node.pattern !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      maximum(node, ctx) {
        if (node.in && node.in === 'body' && node.maximum) {
          return ctx.createError('This field is allowed only if the parameter not in "body". In such case, use Schema object instead');
        }

        if (node && node.maximum && typeof node.maximum !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      minimum(node, ctx) {
        if (node.in && node.in === 'body' && node.minimum) {
          return ctx.createError('This field is allowed only if the parameter not in "body". In such case, use Schema object instead');
        }

        if (node && node.minimum && typeof node.minimum !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      maxLength(node, ctx) {
        if (node.in && node.in === 'body' && node.maxLength) {
          return ctx.createError('This field is allowed only if the parameter not in "body". In such case, use Schema object instead');
        }

        if (node && node.maxLength && typeof node.maxLength !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      minLength(node, ctx) {
        if (node.in && node.in === 'body' && node.minLength) {
          return ctx.createError('This field is allowed only if the parameter not in "body". In such case, use Schema object instead');
        }

        if (node && node.minLength && typeof node.minLength !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      maxItems(node, ctx) {
        if (node.in && node.in === 'body' && node.maxItems) {
          return ctx.createError('This field is allowed only if the parameter not in "body". In such case, use Schema object instead');
        }

        if (node && node.maxItems && typeof node.maxItems !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      minItems(node, ctx) {
        if (node.in && node.in === 'body' && node.minItems) {
          return ctx.createError('This field is allowed only if the parameter not in "body". In such case, use Schema object instead');
        }

        if (node && node.minItems && typeof node.minItems !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      multipleOf(node, ctx) {
        if (node.in && node.in === 'body' && node.multipleOf) {
          return ctx.createError('This field is allowed only if the parameter not in "body". In such case, use Schema object instead');
        }

        if (node && node.multipleOf && typeof node.multipleOf !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      exclusiveMaximum(node, ctx) {
        if (node.in && node.in === 'body' && node.exclusiveMaximum) {
          return ctx.createError('This field is allowed only if the parameter not in "body". In such case, use Schema object instead');
        }

        if (node && node.exclusiveMaximum && typeof node.exclusiveMaximum !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      exclusiveMinimum(node, ctx) {
        if (node.in && node.in === 'body' && node.exclusiveMinimum) {
          return ctx.createError('This field is allowed only if the parameter not in "body". In such case, use Schema object instead');
        }

        if (node && node.exclusiveMinimum && typeof node.exclusiveMinimum !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      uniqueItems(node, ctx) {
        if (node.in && node.in === 'body' && node.uniqueItems) {
          return ctx.createError('This field is allowed only if the parameter not in "body". In such case, use Schema object instead');
        }

        if (node && node.uniqueItems && typeof node.uniqueItems !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      }

    };
  }

  OAS2Parameter() {
    return {
      onEnter: (node, definition, ctx) => ctx.validateFields(this.config, this.rule, this.validators)
    };
  }

}

module.exports = ValidateOAS2Parameter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy92aXNpdG9ycy9ydWxlcy9vYXMyLXN0cnVjdHVyYWwvdmFsaWRhdGVPQVMyUGFyYW1ldGVyLmpzIl0sIm5hbWVzIjpbIlZhbGlkYXRlT0FTMlBhcmFtZXRlciIsInJ1bGUiLCJ2YWxpZGF0b3JzIiwibmFtZSIsIm5vZGUiLCJjdHgiLCJjcmVhdGVFcnJvciIsIm1lc3NhZ2VIZWxwZXJzIiwibWlzc2luZ1JlcXVpcmVkRmllbGQiLCJmaWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIiLCJpbiIsImluY2x1ZGVzIiwiZGVzY3JpcHRpb24iLCJyZXF1aXJlZCIsImRlcHJlY2F0ZWQiLCJzY2hlbWEiLCJ0eXBlIiwiZm9ybWF0IiwiYWxsb3dFbXB0eVZhbHVlIiwiaXRlbXMiLCJwYXR0ZXJuIiwibWF4aW11bSIsIm1pbmltdW0iLCJtYXhMZW5ndGgiLCJtaW5MZW5ndGgiLCJtYXhJdGVtcyIsIm1pbkl0ZW1zIiwibXVsdGlwbGVPZiIsImV4Y2x1c2l2ZU1heGltdW0iLCJleGNsdXNpdmVNaW5pbXVtIiwidW5pcXVlSXRlbXMiLCJPQVMyUGFyYW1ldGVyIiwib25FbnRlciIsImRlZmluaXRpb24iLCJ2YWxpZGF0ZUZpZWxkcyIsImNvbmZpZyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTUEscUJBQU4sQ0FBNEI7QUFDMUIsYUFBV0MsSUFBWCxHQUFrQjtBQUNoQixXQUFPLHVCQUFQO0FBQ0Q7O0FBRUQsTUFBSUMsVUFBSixHQUFpQjtBQUNmLFdBQU87QUFDTEMsTUFBQUEsSUFBSSxDQUFDQyxJQUFELEVBQU9DLEdBQVAsRUFBWTtBQUNkLFlBQUksQ0FBQ0QsSUFBTCxFQUFXLE9BQU8sSUFBUDtBQUNYLFlBQUksQ0FBQ0EsSUFBSSxDQUFDRCxJQUFWLEVBQWdCLE9BQU9FLEdBQUcsQ0FBQ0MsV0FBSixDQUFnQkQsR0FBRyxDQUFDRSxjQUFKLENBQW1CQyxvQkFBbkIsQ0FBd0MsTUFBeEMsQ0FBaEIs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QUNELFlBQUlGLElBQUksSUFBSUEsSUFBSSxDQUFDMEIsV0FBYixJQUE0QixPQUFPMUIsSUFBSSxDQUFDMEIsV0FBWixLQUE0QixTQUE1RCxFQUF1RSxPQUFPekIsR0FBRyxDQUFDQyxXQUFKLENBQWdCRCxHQUFHLENBQUNFLGNBQUosQ0FBbUJFLDhCQUFuQixDQUFrRCxTQUFsRCxDQUFoQixFQUE4RSxPQUE5RSxDQUFQO0FBQ3ZFLGVBQU8sSUFBUDtBQUNEOztBQTdKSSxLQUFQO0FBK0pEOztBQUVEc0IsRUFBQUEsYUFBYSxHQUFHO0FBQ2QsV0FBTztBQUNMQyxNQUFBQSxPQUFPLEVBQUUsQ0FBQzVCLElBQUQsRUFBTzZCLFVBQVAsRUFBbUI1QixHQUFuQixLQUEyQkEsR0FBRyxDQUFDNkIsY0FBSixDQUNsQyxLQUFLQyxNQUQ2QixFQUNyQixLQUFLbEMsSUFEZ0IsRUFDVixLQUFLQyxVQURLO0FBRC9CLEtBQVA7QUFLRDs7QUE3S3lCOztBQWdMNUJrQyxNQUFNLENBQUNDLE9BQVAsR0FBaUJyQyxxQkFBakIiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBWYWxpZGF0ZU9BUzJQYXJhbWV0ZXIge1xuICBzdGF0aWMgZ2V0IHJ1bGUoKSB7XG4gICAgcmV0dXJuICdvYXMyLXNjaGVtYS9wYXJhbWV0ZXInO1xuICB9XG5cbiAgZ2V0IHZhbGlkYXRvcnMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWUobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmICghbm9kZSkgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmICghbm9kZS5uYW1lKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5taXNzaW5nUmVxdWlyZWRGaWVsZCgnbmFtZScpLCAna2V5Jyk7XG4gICAgICAgIGlmICh0eXBlb2Ygbm9kZS5uYW1lICE9PSAnc3RyaW5nJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdzdHJpbmcnKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIGluKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAoIW5vZGUpIHJldHVybiBudWxsO1xuICAgICAgICBpZiAoIW5vZGUuaW4pIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLm1pc3NpbmdSZXF1aXJlZEZpZWxkKCdpbicpLCAna2V5Jyk7XG4gICAgICAgIGlmICh0eXBlb2Ygbm9kZS5pbiAhPT0gJ3N0cmluZycpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignc3RyaW5nJyksICd2YWx1ZScpO1xuICAgICAgICBpZiAoIVsncXVlcnknLCAnaGVhZGVyJywgJ3BhdGgnLCAnYm9keScsICdmb3JtRGF0YSddLmluY2x1ZGVzKG5vZGUuaW4pKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKFwiVGhlICdpbicgZmllbGQgdmFsdWUgY2FuIGJlIG9ubHkgb25lIG9mOiAncXVlcnknLCAnaGVhZGVyJywgJ3BhdGgnLCAnY29va2llJ1wiLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgZGVzY3JpcHRpb24obm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuZGVzY3JpcHRpb24gJiYgdHlwZW9mIG5vZGUuZGVzY3JpcHRpb24gIT09ICdzdHJpbmcnKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ3N0cmluZycpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgcmVxdWlyZWQobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUucmVxdWlyZWQgJiYgdHlwZW9mIG5vZGUucmVxdWlyZWQgIT09ICdib29sZWFuJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdib29sZWFuJyksICd2YWx1ZScpO1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLmluICYmIG5vZGUuaW4gPT09ICdwYXRoJyAmJiBub2RlLnJlcXVpcmVkICE9PSB0cnVlKSB7XG4gICAgICAgICAgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignSWYgdGhlIHBhcmFtZXRlciBsb2NhdGlvbiBpcyBcInBhdGhcIiwgdGhpcyBwcm9wZXJ0eSBpcyBSRVFVSVJFRCBhbmQgaXRzIHZhbHVlIE1VU1QgYmUgdHJ1ZS4nLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBkZXByZWNhdGVkKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLmRlcHJlY2F0ZWQgJiYgdHlwZW9mIG5vZGUuZGVwcmVjYXRlZCAhPT0gJ2Jvb2xlYW4nKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ2Jvb2xlYW4nKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcblxuICAgICAgc2NoZW1hKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZS5pbiAmJiBub2RlLmluID09PSAnYm9keScgJiYgIW5vZGUuc2NoZW1hKSB7XG4gICAgICAgICAgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMubWlzc2luZ1JlcXVpcmVkRmllbGQoJ3NjaGVtYScpLCAna2V5Jyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIShub2RlLmluICYmIG5vZGUuaW4gPT09ICdib2R5JykgJiYgbm9kZS5zY2hlbWEpIHtcbiAgICAgICAgICByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKCdTY2hlbWEgZmllbGQgbWF5IGJlIHByZXNlbnQgb25seSBpZiBwYXJhbWV0ZXIgaXMgaW4gXCJib2R5XCIuJywgJ2tleScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcblxuICAgICAgdHlwZShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUuaW4gJiYgbm9kZS5pbiA9PT0gJ2JvZHknICYmIG5vZGUudHlwZSkge1xuICAgICAgICAgIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1RoaXMgZmllbGQgaXMgYWxsb3dlZCBvbmx5IGlmIHRoZSBwYXJhbWV0ZXIgbm90IGluIFwiYm9keVwiLiBJbiBzdWNoIGNhc2UsIHVzZSBTY2hlbWEgb2JqZWN0IGluc3RlYWQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZSAmJiBub2RlLnR5cGUgJiYgdHlwZW9mIG5vZGUudHlwZSAhPT0gJ3N0cmluZycpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignc3RyaW5nJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG5cbiAgICAgIGZvcm1hdChub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUuaW4gJiYgbm9kZS5pbiA9PT0gJ2JvZHknICYmIG5vZGUuZm9ybWF0KSB7XG4gICAgICAgICAgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVGhpcyBmaWVsZCBpcyBhbGxvd2VkIG9ubHkgaWYgdGhlIHBhcmFtZXRlciBub3QgaW4gXCJib2R5XCIuIEluIHN1Y2ggY2FzZSwgdXNlIFNjaGVtYSBvYmplY3QgaW5zdGVhZCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuZm9ybWF0ICYmIHR5cGVvZiBub2RlLmZvcm1hdCAhPT0gJ3N0cmluZycpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignc3RyaW5nJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG5cbiAgICAgIGFsbG93RW1wdHlWYWx1ZShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUuaW4gJiYgbm9kZS5pbiA9PT0gJ2JvZHknICYmIG5vZGUuYWxsb3dFbXB0eVZhbHVlKSB7XG4gICAgICAgICAgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVGhpcyBmaWVsZCBpcyBhbGxvd2VkIG9ubHkgaWYgdGhlIHBhcmFtZXRlciBub3QgaW4gXCJib2R5XCIuIEluIHN1Y2ggY2FzZSwgdXNlIFNjaGVtYSBvYmplY3QgaW5zdGVhZCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuYWxsb3dFbXB0eVZhbHVlICYmIHR5cGVvZiBub2RlLmFsbG93RW1wdHlWYWx1ZSAhPT0gJ2Jvb2xlYW4nKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ2Jvb2xlYW4nKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcblxuICAgICAgaXRlbXMobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlLmluICYmIG5vZGUuaW4gPT09ICdib2R5JyAmJiBub2RlLml0ZW1zKSB7XG4gICAgICAgICAgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVGhpcyBmaWVsZCBpcyBhbGxvd2VkIG9ubHkgaWYgdGhlIHBhcmFtZXRlciBub3QgaW4gXCJib2R5XCIuIEluIHN1Y2ggY2FzZSwgdXNlIFNjaGVtYSBvYmplY3QgaW5zdGVhZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCEobm9kZS50eXBlICYmIG5vZGUudHlwZSA9PT0gJ2FycmF5JykgJiYgbm9kZS5pdGVtcykge1xuICAgICAgICAgIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1wiSXRlbXNcIiBmaWVsZCBtYXkgYmUgcHJlc2VudCBvbmx5IGlmIHR5cGUgb2YgcGFyYW1ldGVyIGlzIFwiYXJyYXlcIi4nLCAna2V5Jyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobm9kZS50eXBlICYmIG5vZGUudHlwZSA9PT0gJ2FycmF5JyAmJiAhbm9kZS5pdGVtcykge1xuICAgICAgICAgIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLm1pc3NpbmdSZXF1aXJlZEZpZWxkKCdpdGVtcycpLCAna2V5Jyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG5cbiAgICAgIHBhdHRlcm4obm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlLmluICYmIG5vZGUuaW4gPT09ICdib2R5JyAmJiBub2RlLnBhdHRlcm4pIHtcbiAgICAgICAgICByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKCdUaGlzIGZpZWxkIGlzIGFsbG93ZWQgb25seSBpZiB0aGUgcGFyYW1ldGVyIG5vdCBpbiBcImJvZHlcIi4gSW4gc3VjaCBjYXNlLCB1c2UgU2NoZW1hIG9iamVjdCBpbnN0ZWFkJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5wYXR0ZXJuICYmIHR5cGVvZiBub2RlLnBhdHRlcm4gIT09ICdzdHJpbmcnKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ3N0cmluZycpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgbWF4aW11bShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUuaW4gJiYgbm9kZS5pbiA9PT0gJ2JvZHknICYmIG5vZGUubWF4aW11bSkge1xuICAgICAgICAgIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1RoaXMgZmllbGQgaXMgYWxsb3dlZCBvbmx5IGlmIHRoZSBwYXJhbWV0ZXIgbm90IGluIFwiYm9keVwiLiBJbiBzdWNoIGNhc2UsIHVzZSBTY2hlbWEgb2JqZWN0IGluc3RlYWQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZSAmJiBub2RlLm1heGltdW0gJiYgdHlwZW9mIG5vZGUubWF4aW11bSAhPT0gJ251bWJlcicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignbnVtYmVyJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBtaW5pbXVtKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZS5pbiAmJiBub2RlLmluID09PSAnYm9keScgJiYgbm9kZS5taW5pbXVtKSB7XG4gICAgICAgICAgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVGhpcyBmaWVsZCBpcyBhbGxvd2VkIG9ubHkgaWYgdGhlIHBhcmFtZXRlciBub3QgaW4gXCJib2R5XCIuIEluIHN1Y2ggY2FzZSwgdXNlIFNjaGVtYSBvYmplY3QgaW5zdGVhZCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubWluaW11bSAmJiB0eXBlb2Ygbm9kZS5taW5pbXVtICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG1heExlbmd0aChub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUuaW4gJiYgbm9kZS5pbiA9PT0gJ2JvZHknICYmIG5vZGUubWF4TGVuZ3RoKSB7XG4gICAgICAgICAgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVGhpcyBmaWVsZCBpcyBhbGxvd2VkIG9ubHkgaWYgdGhlIHBhcmFtZXRlciBub3QgaW4gXCJib2R5XCIuIEluIHN1Y2ggY2FzZSwgdXNlIFNjaGVtYSBvYmplY3QgaW5zdGVhZCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubWF4TGVuZ3RoICYmIHR5cGVvZiBub2RlLm1heExlbmd0aCAhPT0gJ251bWJlcicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignbnVtYmVyJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBtaW5MZW5ndGgobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlLmluICYmIG5vZGUuaW4gPT09ICdib2R5JyAmJiBub2RlLm1pbkxlbmd0aCkge1xuICAgICAgICAgIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1RoaXMgZmllbGQgaXMgYWxsb3dlZCBvbmx5IGlmIHRoZSBwYXJhbWV0ZXIgbm90IGluIFwiYm9keVwiLiBJbiBzdWNoIGNhc2UsIHVzZSBTY2hlbWEgb2JqZWN0IGluc3RlYWQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZSAmJiBub2RlLm1pbkxlbmd0aCAmJiB0eXBlb2Ygbm9kZS5taW5MZW5ndGggIT09ICdudW1iZXInKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ251bWJlcicpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgbWF4SXRlbXMobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlLmluICYmIG5vZGUuaW4gPT09ICdib2R5JyAmJiBub2RlLm1heEl0ZW1zKSB7XG4gICAgICAgICAgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVGhpcyBmaWVsZCBpcyBhbGxvd2VkIG9ubHkgaWYgdGhlIHBhcmFtZXRlciBub3QgaW4gXCJib2R5XCIuIEluIHN1Y2ggY2FzZSwgdXNlIFNjaGVtYSBvYmplY3QgaW5zdGVhZCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubWF4SXRlbXMgJiYgdHlwZW9mIG5vZGUubWF4SXRlbXMgIT09ICdudW1iZXInKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ251bWJlcicpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgbWluSXRlbXMobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlLmluICYmIG5vZGUuaW4gPT09ICdib2R5JyAmJiBub2RlLm1pbkl0ZW1zKSB7XG4gICAgICAgICAgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVGhpcyBmaWVsZCBpcyBhbGxvd2VkIG9ubHkgaWYgdGhlIHBhcmFtZXRlciBub3QgaW4gXCJib2R5XCIuIEluIHN1Y2ggY2FzZSwgdXNlIFNjaGVtYSBvYmplY3QgaW5zdGVhZCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubWluSXRlbXMgJiYgdHlwZW9mIG5vZGUubWluSXRlbXMgIT09ICdudW1iZXInKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ251bWJlcicpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgbXVsdGlwbGVPZihub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUuaW4gJiYgbm9kZS5pbiA9PT0gJ2JvZHknICYmIG5vZGUubXVsdGlwbGVPZikge1xuICAgICAgICAgIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1RoaXMgZmllbGQgaXMgYWxsb3dlZCBvbmx5IGlmIHRoZSBwYXJhbWV0ZXIgbm90IGluIFwiYm9keVwiLiBJbiBzdWNoIGNhc2UsIHVzZSBTY2hlbWEgb2JqZWN0IGluc3RlYWQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZSAmJiBub2RlLm11bHRpcGxlT2YgJiYgdHlwZW9mIG5vZGUubXVsdGlwbGVPZiAhPT0gJ251bWJlcicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignbnVtYmVyJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBleGNsdXNpdmVNYXhpbXVtKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZS5pbiAmJiBub2RlLmluID09PSAnYm9keScgJiYgbm9kZS5leGNsdXNpdmVNYXhpbXVtKSB7XG4gICAgICAgICAgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVGhpcyBmaWVsZCBpcyBhbGxvd2VkIG9ubHkgaWYgdGhlIHBhcmFtZXRlciBub3QgaW4gXCJib2R5XCIuIEluIHN1Y2ggY2FzZSwgdXNlIFNjaGVtYSBvYmplY3QgaW5zdGVhZCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuZXhjbHVzaXZlTWF4aW11bSAmJiB0eXBlb2Ygbm9kZS5leGNsdXNpdmVNYXhpbXVtICE9PSAnYm9vbGVhbicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignYm9vbGVhbicpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgZXhjbHVzaXZlTWluaW11bShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUuaW4gJiYgbm9kZS5pbiA9PT0gJ2JvZHknICYmIG5vZGUuZXhjbHVzaXZlTWluaW11bSkge1xuICAgICAgICAgIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1RoaXMgZmllbGQgaXMgYWxsb3dlZCBvbmx5IGlmIHRoZSBwYXJhbWV0ZXIgbm90IGluIFwiYm9keVwiLiBJbiBzdWNoIGNhc2UsIHVzZSBTY2hlbWEgb2JqZWN0IGluc3RlYWQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZSAmJiBub2RlLmV4Y2x1c2l2ZU1pbmltdW0gJiYgdHlwZW9mIG5vZGUuZXhjbHVzaXZlTWluaW11bSAhPT0gJ2Jvb2xlYW4nKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ2Jvb2xlYW4nKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIHVuaXF1ZUl0ZW1zKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZS5pbiAmJiBub2RlLmluID09PSAnYm9keScgJiYgbm9kZS51bmlxdWVJdGVtcykge1xuICAgICAgICAgIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1RoaXMgZmllbGQgaXMgYWxsb3dlZCBvbmx5IGlmIHRoZSBwYXJhbWV0ZXIgbm90IGluIFwiYm9keVwiLiBJbiBzdWNoIGNhc2UsIHVzZSBTY2hlbWEgb2JqZWN0IGluc3RlYWQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZSAmJiBub2RlLnVuaXF1ZUl0ZW1zICYmIHR5cGVvZiBub2RlLnVuaXF1ZUl0ZW1zICE9PSAnYm9vbGVhbicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignYm9vbGVhbicpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBPQVMyUGFyYW1ldGVyKCkge1xuICAgIHJldHVybiB7XG4gICAgICBvbkVudGVyOiAobm9kZSwgZGVmaW5pdGlvbiwgY3R4KSA9PiBjdHgudmFsaWRhdGVGaWVsZHMoXG4gICAgICAgIHRoaXMuY29uZmlnLCB0aGlzLnJ1bGUsIHRoaXMudmFsaWRhdG9ycyxcbiAgICAgICksXG4gICAgfTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFZhbGlkYXRlT0FTMlBhcmFtZXRlcjtcbiJdfQ==