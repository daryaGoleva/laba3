"use strict";

var _utils = require("../../../utils");

class ValidateOpenAPISchema {
  static get rule() {
    return 'oas3-schema/schema';
  }

  get validators() {
    return {
      title(node, ctx) {
        if (node && node.title) {
          if (!(typeof node.title === 'string')) return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        }

        return null;
      },

      multipleOf(node, ctx) {
        if (node && node.multipleOf) {
          if (typeof node.multipleOf !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.multipleOf < 0) return ctx.createError('Value of multipleOf must be greater or equal to zero', 'value');
        }

        return null;
      },

      maximum(node, ctx) {
        if (node && node.maximum && typeof node.maximum !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      exclusiveMaximum(node, ctx) {
        if (node && node.exclusiveMaximum && typeof node.exclusiveMaximum !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      minimum(node, ctx) {
        if (node && node.minimum && typeof node.minimum !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      exclusiveMinimum(node, ctx) {
        if (node && node.exclusiveMinimum && typeof node.exclusiveMinimum !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      maxLength(node, ctx) {
        if (node && node.maxLength) {
          if (typeof node.maxLength !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.maxLength < 0) return ctx.createError('Value of maxLength must be greater or equal to zero.', 'value');
        }

        return null;
      },

      minLength(node, ctx) {
        if (node && node.minLength) {
          if (typeof node.minLength !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.minLength < 0) return ctx.createError('Value of minLength must be greater or equal to zero.', 'value');
        }

        return null;
      },

      pattern(node, ctx) {
        if (node && node.pattern) {
          // TODO: add regexp validation.
          if (typeof node.pattern !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        }

        return null;
      },

      maxItems(node, ctx) {
        if (node && node.maxItems) {
          if (typeof node.maxItems !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.maxItems < 0) return ctx.createError('Value of maxItems must be greater or equal to zero. You can`t have negative amount of something.', 'value');
        }

        return null;
      },

      minItems(node, ctx) {
        if (node && node.minItems) {
          if (typeof node.minItems !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.minItems < 0) return ctx.createError('Value of minItems must be greater or equal to zero. You can`t have negative amount of something.', 'value');
        }

        return null;
      },

      uniqueItems(node, ctx) {
        if (node && node.uniqueItems) {
          if (typeof node.uniqueItems !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        }

        return null;
      },

      maxProperties(node, ctx) {
        if (node && node.maxProperties) {
          if (typeof node.maxProperties !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.maxProperties < 0) return ctx.createError('Value of maxProperties must be greater or equal to zero. You can`t have negative amount of something.', 'value');
        }

        return null;
      },

      minProperties(node, ctx) {
        if (node && node.minProperties) {
          if (typeof node.minProperties !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.minProperties < 0) return ctx.createError('Value of minProperties must be greater or equal to zero. You can`t have negative amount of something.', 'value');
        }

        return null;
      },

      required(node, ctx) {
        if (node && node.required) {
          if (!Array.isArray(node.required)) return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('array'), 'value');
          if (node.required.filter(item => typeof item !== 'string').length !== 0) return ctx.createError('All values of "required" field must be strings', 'value');
        }

        return null;
      },

      enum(node, ctx) {
        const errors = [];

        if (node && node.enum) {
          if (!Array.isArray(node.enum)) return [ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('array'), 'value')];
        }

        return errors;
      },

      type(node, ctx) {
        const errors = [];
        if (node.type && node.type && typeof node.type !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');

        if (node.type && !['string', 'object', 'array', 'integer', 'number', 'boolean'].includes(node.type)) {
          const possibleAlternate = (0, _utils.getClosestString)(node.type, ['string', 'object', 'array', 'integer', 'number', 'boolean']);
          errors.push(ctx.createError('Object type can be one of following only: "string", "object", "array", "integer", "number", "boolean".', 'value', {
            possibleAlternate
          }));
        }

        return errors;
      },

      items(node, ctx) {
        if (node && node.items && Array.isArray(node.items)) return ctx.createError('Value of items must not be an array. It must be a Schema object', 'value');
        return null;
      },

      additionalProperties: (node, ctx) => {
        if (node && node.additionalProperties && ['boolean', 'object'].indexOf(typeof node.additionalProperties) === -1) {
          return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean or OpenAPI Schema'), 'value');
        }

        return null;
      },

      description(node, ctx) {
        if (node && node.description && typeof node.description !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      format(node, ctx) {
        if (node && node.format && typeof node.format !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      nullable(node, ctx) {
        if (node && node.nullable && typeof node.nullable !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      readOnly(node, ctx) {
        if (node && node.readOnly && typeof node.readOnly !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      writeOnly(node, ctx) {
        if (node && node.writeOnly && typeof node.writeOnly !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      deprecated(node, ctx) {
        if (node && node.deprecated && typeof node.deprecated !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      }

    };
  }

  OpenAPISchema() {
    return {
      onEnter: (node, definition, ctx) => ctx.validateFields(this.config, this.rule, this.validators)
    };
  }

}

module.exports = ValidateOpenAPISchema;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy92aXNpdG9ycy9ydWxlcy9zdHJ1Y3R1cmFsL3ZhbGlkYXRlT3BlbkFQSVNjaGVtYS5qcyJdLCJuYW1lcyI6WyJWYWxpZGF0ZU9wZW5BUElTY2hlbWEiLCJydWxlIiwidmFsaWRhdG9ycyIsInRpdGxlIiwibm9kZSIsImN0eCIsImNyZWF0ZUVycm9yIiwibWVzc2FnZUhlbHBlcnMiLCJmaWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIiLCJtdWx0aXBsZU9mIiwibWF4aW11bSIsImV4Y2x1c2l2ZU1heGltdW0iLCJtaW5pbXVtIiwiZXhjbHVzaXZlTWluaW11bSIsIm1heExlbmd0aCIsIm1pbkxlbmd0aCIsInBhdHRlcm4iLCJtYXhJdGVtcyIsIm1pbkl0ZW1zIiwidW5pcXVlSXRlbXMiLCJtYXhQcm9wZXJ0aWVzIiwibWluUHJvcGVydGllcyIsInJlcXVpcmVkIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiaXRlbSIsImxlbmd0aCIsImVudW0iLCJlcnJvcnMiLCJ0eXBlIiwiaW5jbHVkZXMiLCJwb3NzaWJsZUFsdGVybmF0ZSIsInB1c2giLCJpdGVtcyIsImFkZGl0aW9uYWxQcm9wZXJ0aWVzIiwiaW5kZXhPZiIsImRlc2NyaXB0aW9uIiwiZm9ybWF0IiwibnVsbGFibGUiLCJyZWFkT25seSIsIndyaXRlT25seSIsImRlcHJlY2F0ZWQiLCJPcGVuQVBJU2NoZW1hIiwib25FbnRlciIsImRlZmluaXRpb24iLCJ2YWxpZGF0ZUZpZWxkcyIsImNvbmZpZyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7O0FBQUE7O0FBR0EsTUFBTUEscUJBQU4sQ0FBNEI7QUFDMUIsYUFBV0MsSUFBWCxHQUFrQjtBQUNoQixXQUFPLG9CQUFQO0FBQ0Q7O0FBRUQsTUFBSUMsVUFBSixHQUFpQjtBQUNmLFdBQU87QUFDTEMsTUFBQUEsS0FBSyxDQUFDQyxJQUFELEVBQU9DLEdBQVAsRUFBWTtBQUNmLFlBQUlELElBQUksSUFB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QUQ2QixFQUNyQixLQUFLOUMsSUFEZ0IsRUFDVixLQUFLQyxVQURLO0FBRC9CLEtBQVA7QUFLRDs7QUFoS3lCOztBQW1LNUI4QyxNQUFNLENBQUNDLE9BQVAsR0FBaUJqRCxxQkFBakIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXRDbG9zZXN0U3RyaW5nIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMnO1xuXG5cbmNsYXNzIFZhbGlkYXRlT3BlbkFQSVNjaGVtYSB7XG4gIHN0YXRpYyBnZXQgcnVsZSgpIHtcbiAgICByZXR1cm4gJ29hczMtc2NoZW1hL3NjaGVtYSc7XG4gIH1cblxuICBnZXQgdmFsaWRhdG9ycygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdGl0bGUobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUudGl0bGUpIHtcbiAgICAgICAgICBpZiAoISh0eXBlb2Ygbm9kZS50aXRsZSA9PT0gJ3N0cmluZycpKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ3N0cmluZycpLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBtdWx0aXBsZU9mKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLm11bHRpcGxlT2YpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIG5vZGUubXVsdGlwbGVPZiAhPT0gJ251bWJlcicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignbnVtYmVyJyksICd2YWx1ZScpO1xuICAgICAgICAgIGlmIChub2RlLm11bHRpcGxlT2YgPCAwKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKCdWYWx1ZSBvZiBtdWx0aXBsZU9mIG11c3QgYmUgZ3JlYXRlciBvciBlcXVhbCB0byB6ZXJvJywgJ3ZhbHVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgbWF4aW11bShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5tYXhpbXVtICYmIHR5cGVvZiBub2RlLm1heGltdW0gIT09ICdudW1iZXInKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ251bWJlcicpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgZXhjbHVzaXZlTWF4aW11bShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5leGNsdXNpdmVNYXhpbXVtICYmIHR5cGVvZiBub2RlLmV4Y2x1c2l2ZU1heGltdW0gIT09ICdib29sZWFuJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdib29sZWFuJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBtaW5pbXVtKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLm1pbmltdW0gJiYgdHlwZW9mIG5vZGUubWluaW11bSAhPT0gJ251bWJlcicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignbnVtYmVyJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBleGNsdXNpdmVNaW5pbXVtKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLmV4Y2x1c2l2ZU1pbmltdW0gJiYgdHlwZW9mIG5vZGUuZXhjbHVzaXZlTWluaW11bSAhPT0gJ2Jvb2xlYW4nKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ2Jvb2xlYW4nKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG1heExlbmd0aChub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5tYXhMZW5ndGgpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIG5vZGUubWF4TGVuZ3RoICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgICAgaWYgKG5vZGUubWF4TGVuZ3RoIDwgMCkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVmFsdWUgb2YgbWF4TGVuZ3RoIG11c3QgYmUgZ3JlYXRlciBvciBlcXVhbCB0byB6ZXJvLicsICd2YWx1ZScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG1pbkxlbmd0aChub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5taW5MZW5ndGgpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIG5vZGUubWluTGVuZ3RoICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgICAgaWYgKG5vZGUubWluTGVuZ3RoIDwgMCkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVmFsdWUgb2YgbWluTGVuZ3RoIG11c3QgYmUgZ3JlYXRlciBvciBlcXVhbCB0byB6ZXJvLicsICd2YWx1ZScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIHBhdHRlcm4obm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUucGF0dGVybikge1xuICAgICAgICAgIC8vIFRPRE86IGFkZCByZWdleHAgdmFsaWRhdGlvbi5cbiAgICAgICAgICBpZiAodHlwZW9mIG5vZGUucGF0dGVybiAhPT0gJ3N0cmluZycpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignc3RyaW5nJyksICd2YWx1ZScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG1heEl0ZW1zKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLm1heEl0ZW1zKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBub2RlLm1heEl0ZW1zICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgICAgaWYgKG5vZGUubWF4SXRlbXMgPCAwKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKCdWYWx1ZSBvZiBtYXhJdGVtcyBtdXN0IGJlIGdyZWF0ZXIgb3IgZXF1YWwgdG8gemVyby4gWW91IGNhbmB0IGhhdmUgbmVnYXRpdmUgYW1vdW50IG9mIHNvbWV0aGluZy4nLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBtaW5JdGVtcyhub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5taW5JdGVtcykge1xuICAgICAgICAgIGlmICh0eXBlb2Ygbm9kZS5taW5JdGVtcyAhPT0gJ251bWJlcicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignbnVtYmVyJyksICd2YWx1ZScpO1xuICAgICAgICAgIGlmIChub2RlLm1pbkl0ZW1zIDwgMCkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVmFsdWUgb2YgbWluSXRlbXMgbXVzdCBiZSBncmVhdGVyIG9yIGVxdWFsIHRvIHplcm8uIFlvdSBjYW5gdCBoYXZlIG5lZ2F0aXZlIGFtb3VudCBvZiBzb21ldGhpbmcuJywgJ3ZhbHVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgdW5pcXVlSXRlbXMobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUudW5pcXVlSXRlbXMpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIG5vZGUudW5pcXVlSXRlbXMgIT09ICdib29sZWFuJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdib29sZWFuJyksICd2YWx1ZScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG1heFByb3BlcnRpZXMobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubWF4UHJvcGVydGllcykge1xuICAgICAgICAgIGlmICh0eXBlb2Ygbm9kZS5tYXhQcm9wZXJ0aWVzICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgICAgaWYgKG5vZGUubWF4UHJvcGVydGllcyA8IDApIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1ZhbHVlIG9mIG1heFByb3BlcnRpZXMgbXVzdCBiZSBncmVhdGVyIG9yIGVxdWFsIHRvIHplcm8uIFlvdSBjYW5gdCBoYXZlIG5lZ2F0aXZlIGFtb3VudCBvZiBzb21ldGhpbmcuJywgJ3ZhbHVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgbWluUHJvcGVydGllcyhub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5taW5Qcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBub2RlLm1pblByb3BlcnRpZXMgIT09ICdudW1iZXInKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ251bWJlcicpLCAndmFsdWUnKTtcbiAgICAgICAgICBpZiAobm9kZS5taW5Qcm9wZXJ0aWVzIDwgMCkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVmFsdWUgb2YgbWluUHJvcGVydGllcyBtdXN0IGJlIGdyZWF0ZXIgb3IgZXF1YWwgdG8gemVyby4gWW91IGNhbmB0IGhhdmUgbmVnYXRpdmUgYW1vdW50IG9mIHNvbWV0aGluZy4nLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICByZXF1aXJlZChub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5yZXF1aXJlZCkge1xuICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShub2RlLnJlcXVpcmVkKSkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdhcnJheScpLCAndmFsdWUnKTtcbiAgICAgICAgICBpZiAobm9kZS5yZXF1aXJlZC5maWx0ZXIoKGl0ZW0pID0+IHR5cGVvZiBpdGVtICE9PSAnc3RyaW5nJykubGVuZ3RoICE9PSAwKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKCdBbGwgdmFsdWVzIG9mIFwicmVxdWlyZWRcIiBmaWVsZCBtdXN0IGJlIHN0cmluZ3MnLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBlbnVtKG5vZGUsIGN0eCkge1xuICAgICAgICBjb25zdCBlcnJvcnMgPSBbXTtcblxuICAgICAgICBpZiAobm9kZSAmJiBub2RlLmVudW0pIHtcbiAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkobm9kZS5lbnVtKSkgcmV0dXJuIFtjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignYXJyYXknKSwgJ3ZhbHVlJyldO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlcnJvcnM7XG4gICAgICB9LFxuICAgICAgdHlwZShub2RlLCBjdHgpIHtcbiAgICAgICAgY29uc3QgZXJyb3JzID0gW107XG4gICAgICAgIGlmIChub2RlLnR5cGUgJiYgbm9kZS50eXBlICYmIHR5cGVvZiBub2RlLnR5cGUgIT09ICdzdHJpbmcnKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ3N0cmluZycpLCAndmFsdWUnKTtcbiAgICAgICAgaWYgKG5vZGUudHlwZSAmJiAhWydzdHJpbmcnLCAnb2JqZWN0JywgJ2FycmF5JywgJ2ludGVnZXInLCAnbnVtYmVyJywgJ2Jvb2xlYW4nXS5pbmNsdWRlcyhub2RlLnR5cGUpKSB7XG4gICAgICAgICAgY29uc3QgcG9zc2libGVBbHRlcm5hdGUgPSBnZXRDbG9zZXN0U3RyaW5nKG5vZGUudHlwZSwgWydzdHJpbmcnLCAnb2JqZWN0JywgJ2FycmF5JywgJ2ludGVnZXInLCAnbnVtYmVyJywgJ2Jvb2xlYW4nXSk7XG4gICAgICAgICAgZXJyb3JzLnB1c2goY3R4LmNyZWF0ZUVycm9yKCdPYmplY3QgdHlwZSBjYW4gYmUgb25lIG9mIGZvbGxvd2luZyBvbmx5OiBcInN0cmluZ1wiLCBcIm9iamVjdFwiLCBcImFycmF5XCIsIFwiaW50ZWdlclwiLCBcIm51bWJlclwiLCBcImJvb2xlYW5cIi4nLCAndmFsdWUnLCB7IHBvc3NpYmxlQWx0ZXJuYXRlIH0pKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZXJyb3JzO1xuICAgICAgfSxcbiAgICAgIGl0ZW1zKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLml0ZW1zICYmIEFycmF5LmlzQXJyYXkobm9kZS5pdGVtcykpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1ZhbHVlIG9mIGl0ZW1zIG11c3Qgbm90IGJlIGFuIGFycmF5LiBJdCBtdXN0IGJlIGEgU2NoZW1hIG9iamVjdCcsICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBhZGRpdGlvbmFsUHJvcGVydGllczogKG5vZGUsIGN0eCkgPT4ge1xuICAgICAgICBpZiAobm9kZVxuICAgICAgICAgICYmIG5vZGUuYWRkaXRpb25hbFByb3BlcnRpZXNcbiAgICAgICAgICAmJiAoWydib29sZWFuJywgJ29iamVjdCddLmluZGV4T2YodHlwZW9mIG5vZGUuYWRkaXRpb25hbFByb3BlcnRpZXMpID09PSAtMSkpIHtcbiAgICAgICAgICByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ2Jvb2xlYW4gb3IgT3BlbkFQSSBTY2hlbWEnKSwgJ3ZhbHVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgZGVzY3JpcHRpb24obm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuZGVzY3JpcHRpb24gJiYgdHlwZW9mIG5vZGUuZGVzY3JpcHRpb24gIT09ICdzdHJpbmcnKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ3N0cmluZycpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgZm9ybWF0KG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLmZvcm1hdCAmJiB0eXBlb2Ygbm9kZS5mb3JtYXQgIT09ICdzdHJpbmcnKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ3N0cmluZycpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgbnVsbGFibGUobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubnVsbGFibGUgJiYgdHlwZW9mIG5vZGUubnVsbGFibGUgIT09ICdib29sZWFuJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdib29sZWFuJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICByZWFkT25seShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5yZWFkT25seSAmJiB0eXBlb2Ygbm9kZS5yZWFkT25seSAhPT0gJ2Jvb2xlYW4nKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ2Jvb2xlYW4nKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIHdyaXRlT25seShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS53cml0ZU9ubHkgJiYgdHlwZW9mIG5vZGUud3JpdGVPbmx5ICE9PSAnYm9vbGVhbicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignYm9vbGVhbicpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgZGVwcmVjYXRlZChub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5kZXByZWNhdGVkICYmIHR5cGVvZiBub2RlLmRlcHJlY2F0ZWQgIT09ICdib29sZWFuJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdib29sZWFuJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIE9wZW5BUElTY2hlbWEoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG9uRW50ZXI6IChub2RlLCBkZWZpbml0aW9uLCBjdHgpID0+IGN0eC52YWxpZGF0ZUZpZWxkcyhcbiAgICAgICAgdGhpcy5jb25maWcsIHRoaXMucnVsZSwgdGhpcy52YWxpZGF0b3JzLFxuICAgICAgKSxcbiAgICB9O1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gVmFsaWRhdGVPcGVuQVBJU2NoZW1hO1xuIl19