"use strict";

var _utils = require("../../../utils");

class ValidateOAS2Header {
  static get rule() {
    return 'oas2-schema/header';
  }

  get validators() {
    return {
      type(node, ctx) {
        if (node && !node.type) {
          return ctx.createError(ctx.messageHelpers.missingRequiredField('type'), 'key');
        }

        if (node && node.type && typeof node.type !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      format(node, ctx) {
        if (node && node.format && typeof node.format !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      items(node, ctx) {
        if (node && node.type === 'array' && !node.items) {
          return ctx.createError(ctx.messageHelpers.missingRequiredField('items'), 'key');
        }

        return null;
      },

      collectionFormat(node, ctx) {
        if (node && node.collectionFormat && typeof node.collectionFormat !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');

        if (node.collectionFormat && !['csv', 'ssv', 'tsv', 'pipes', 'multi'].includes(node.collectionFormat)) {
          const possibleAlternate = (0, _utils.getClosestString)(node.type, ['csv', 'ssv', 'tsv', 'pipes', 'multi']);
          return ctx.createError('The value of "collectionFormat" field can be one of following only: "csv", "ssv", "tsv", "pipes", "multi".', 'value', {
            possibleAlternate
          });
        }

        return null;
      },

      description(node, ctx) {
        if (node && node.description && typeof node.description !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      pattern(node, ctx) {
        if (node && node.pattern && typeof node.pattern !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      maximum(node, ctx) {
        if (node && node.maximum && typeof node.maximum !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      minimum(node, ctx) {
        if (node && node.minimum && typeof node.minimum !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      maxLength(node, ctx) {
        if (node && node.maxLength && typeof node.maxLength !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      minLength(node, ctx) {
        if (node && node.minLength && typeof node.minLength !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      maxItems(node, ctx) {
        if (node && node.maxItems && typeof node.maxItems !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      minItems(node, ctx) {
        if (node && node.minItems && typeof node.minItems !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      multipleOf(node, ctx) {
        if (node && node.multipleOf && typeof node.multipleOf !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      exclusiveMaximum(node, ctx) {
        if (node && node.exclusiveMaximum && typeof node.exclusiveMaximum !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      exclusiveMinimum(node, ctx) {
        if (node && node.exclusiveMinimum && typeof node.exclusiveMinimum !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      uniqueItems(node, ctx) {
        if (node && node.uniqueItems && typeof node.uniqueItems !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      }

    };
  }

  OAS2Header() {
    return {
      onEnter: (node, definition, ctx) => ctx.validateFields(this.config, this.rule, this.validators)
    };
  }

}

module.exports = ValidateOAS2Header;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy92aXNpdG9ycy9ydWxlcy9vYXMyLXN0cnVjdHVyYWwvdmFsaWRhdGVPQVMySGVhZGVyLmpzIl0sIm5hbWVzIjpbIlZhbGlkYXRlT0FTMkhlYWRlciIsInJ1bGUiLCJ2YWxpZGF0b3JzIiwidHlwZSIsIm5vZGUiLCJjdHgiLCJjcmVhdGVFcnJvciIsIm1lc3NhZ2VIZWxwZXJzIiwibWlzc2luZ1JlcXVpcmVkRmllbGQiLCJmaWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIiLCJmb3JtYXQiLCJpdGVtcyIsImNvbGxlY3Rpb25Gb3JtYXQiLCJpbmNsdWRlcyIsInBvc3NpYmxlQWx0ZXJuYXRlIiwiZGVzY3JpcHRpb24iLCJwYXR0ZXJuIiwibWF4aW11bSIsIm1pbmltdW0iLCJtYXhMZW5ndGgiLCJtaW5MZW5ndGgiLCJtYXhJdGVtcyIsIm1pbkl0ZW1zIiwibXVsdGlwbGVPZiIsImV4Y2x1c2l2ZU1heGltdW0iLCJleGNsdXNpdmVNaW5pbXVtIiwidW5pcXVlSXRlbXMiLCJPQVMySGVhZGVyIiwib25FbnRlciIsImRlZmluaXRpb24iLCJ2YWxpZGF0ZUZpZWxkcyIsImNvbmZpZyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7O0FBQUE7O0FBRUEsTUFBTUEsa0JBQU4sQ0FBeUI7QUFDdkIsYUFBV0MsSUFBWCxHQUFrQjtBQUNoQixXQUFPLG9CQUFQO0FBQ0Q7O0FBRUQsTUFBSUMsVUFBSixHQUFpQjtBQUNmLFdBQU87QUFDTEMsTUFBQUEsSUFBSSxDQUFDQyxJQUFELEVBQU9DLEdBQVAsRUFBWTtBQUNkLFlBQUlELElBQUksSUFBSSxDQUFDQSxJQUFJLENBQUNELElBQWxCLEVBQXdCO0FBQ3RCLGlCQUFPRSxHQUFHLENBQUNDLFdBQUosQ0FBZ0JELEdBQUcsQ0FBQ0UsY0FBSixDQUFtQkMsb0JBQW5CLENBQXdDLE1BQXhDLENBQWhCLEVBQWlFLEtBQWpFLENBQVA7QUFDRDs7QUFDRCxZQUFJSixJQUFJLElBQUlB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eUIsY0FBSixDQUNsQyxLQUFLQyxNQUQ2QixFQUNyQixLQUFLOUIsSUFEZ0IsRUFDVixLQUFLQyxVQURLO0FBRC9CLEtBQVA7QUFLRDs7QUF6RnNCOztBQTRGekI4QixNQUFNLENBQUNDLE9BQVAsR0FBaUJqQyxrQkFBakIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXRDbG9zZXN0U3RyaW5nIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMnO1xuXG5jbGFzcyBWYWxpZGF0ZU9BUzJIZWFkZXIge1xuICBzdGF0aWMgZ2V0IHJ1bGUoKSB7XG4gICAgcmV0dXJuICdvYXMyLXNjaGVtYS9oZWFkZXInO1xuICB9XG5cbiAgZ2V0IHZhbGlkYXRvcnMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGUobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmICFub2RlLnR5cGUpIHtcbiAgICAgICAgICByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5taXNzaW5nUmVxdWlyZWRGaWVsZCgndHlwZScpLCAna2V5Jyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS50eXBlICYmIHR5cGVvZiBub2RlLnR5cGUgIT09ICdzdHJpbmcnKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ3N0cmluZycpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgZm9ybWF0KG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLmZvcm1hdCAmJiB0eXBlb2Ygbm9kZS5mb3JtYXQgIT09ICdzdHJpbmcnKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ3N0cmluZycpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgaXRlbXMobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUudHlwZSA9PT0gJ2FycmF5JyAmJiAhbm9kZS5pdGVtcykge1xuICAgICAgICAgIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLm1pc3NpbmdSZXF1aXJlZEZpZWxkKCdpdGVtcycpLCAna2V5Jyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgY29sbGVjdGlvbkZvcm1hdChub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5jb2xsZWN0aW9uRm9ybWF0ICYmIHR5cGVvZiBub2RlLmNvbGxlY3Rpb25Gb3JtYXQgIT09ICdzdHJpbmcnKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ3N0cmluZycpLCAndmFsdWUnKTtcbiAgICAgICAgaWYgKG5vZGUuY29sbGVjdGlvbkZvcm1hdCAmJiAhWydjc3YnLCAnc3N2JywgJ3RzdicsICdwaXBlcycsICdtdWx0aSddLmluY2x1ZGVzKG5vZGUuY29sbGVjdGlvbkZvcm1hdCkpIHtcbiAgICAgICAgICBjb25zdCBwb3NzaWJsZUFsdGVybmF0ZSA9IGdldENsb3Nlc3RTdHJpbmcobm9kZS50eXBlLCBbJ2NzdicsICdzc3YnLCAndHN2JywgJ3BpcGVzJywgJ211bHRpJ10pO1xuICAgICAgICAgIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1RoZSB2YWx1ZSBvZiBcImNvbGxlY3Rpb25Gb3JtYXRcIiBmaWVsZCBjYW4gYmUgb25lIG9mIGZvbGxvd2luZyBvbmx5OiBcImNzdlwiLCBcInNzdlwiLCBcInRzdlwiLCBcInBpcGVzXCIsIFwibXVsdGlcIi4nLCAndmFsdWUnLCB7IHBvc3NpYmxlQWx0ZXJuYXRlIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIGRlc2NyaXB0aW9uKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLmRlc2NyaXB0aW9uICYmIHR5cGVvZiBub2RlLmRlc2NyaXB0aW9uICE9PSAnc3RyaW5nJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdzdHJpbmcnKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIHBhdHRlcm4obm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUucGF0dGVybiAmJiB0eXBlb2Ygbm9kZS5wYXR0ZXJuICE9PSAnc3RyaW5nJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdzdHJpbmcnKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG1heGltdW0obm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubWF4aW11bSAmJiB0eXBlb2Ygbm9kZS5tYXhpbXVtICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG1pbmltdW0obm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubWluaW11bSAmJiB0eXBlb2Ygbm9kZS5taW5pbXVtICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG1heExlbmd0aChub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5tYXhMZW5ndGggJiYgdHlwZW9mIG5vZGUubWF4TGVuZ3RoICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG1pbkxlbmd0aChub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5taW5MZW5ndGggJiYgdHlwZW9mIG5vZGUubWluTGVuZ3RoICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG1heEl0ZW1zKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLm1heEl0ZW1zICYmIHR5cGVvZiBub2RlLm1heEl0ZW1zICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG1pbkl0ZW1zKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLm1pbkl0ZW1zICYmIHR5cGVvZiBub2RlLm1pbkl0ZW1zICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG11bHRpcGxlT2Yobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubXVsdGlwbGVPZiAmJiB0eXBlb2Ygbm9kZS5tdWx0aXBsZU9mICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIGV4Y2x1c2l2ZU1heGltdW0obm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuZXhjbHVzaXZlTWF4aW11bSAmJiB0eXBlb2Ygbm9kZS5leGNsdXNpdmVNYXhpbXVtICE9PSAnYm9vbGVhbicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignYm9vbGVhbicpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgZXhjbHVzaXZlTWluaW11bShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5leGNsdXNpdmVNaW5pbXVtICYmIHR5cGVvZiBub2RlLmV4Y2x1c2l2ZU1pbmltdW0gIT09ICdib29sZWFuJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdib29sZWFuJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICB1bmlxdWVJdGVtcyhub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS51bmlxdWVJdGVtcyAmJiB0eXBlb2Ygbm9kZS51bmlxdWVJdGVtcyAhPT0gJ2Jvb2xlYW4nKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ2Jvb2xlYW4nKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgT0FTMkhlYWRlcigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgb25FbnRlcjogKG5vZGUsIGRlZmluaXRpb24sIGN0eCkgPT4gY3R4LnZhbGlkYXRlRmllbGRzKFxuICAgICAgICB0aGlzLmNvbmZpZywgdGhpcy5ydWxlLCB0aGlzLnZhbGlkYXRvcnMsXG4gICAgICApLFxuICAgIH07XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBWYWxpZGF0ZU9BUzJIZWFkZXI7XG4iXX0=